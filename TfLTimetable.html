<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>TfLTimetable.utf8</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cerulean.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceLine, a.sourceLine { display: inline-block; min-height: 1.25em; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; }
@media print {
code.sourceCode { white-space: pre-wrap; }
div.sourceLine, a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource div.sourceLine, .numberSource a.sourceLine
  { position: relative; }
pre.numberSource div.sourceLine::before, .numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em; }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; color: #aaaaaa;  padding-left: 4px; }
pre, code { background-color: #f8f8f8; }
@media screen {
a.sourceLine::before { text-decoration: underline; color: initial; }
}
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.bn { color: #0000cf; } /* BaseN */
code span.fl { color: #0000cf; } /* Float */
code span.ch { color: #4e9a06; } /* Char */
code span.st { color: #4e9a06; } /* String */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.ot { color: #8f5902; } /* Other */
code span.al { color: #ef2929; } /* Alert */
code span.fu { color: #000000; } /* Function */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
code span.cn { color: #000000; } /* Constant */
code span.sc { color: #000000; } /* SpecialChar */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.im { } /* Import */
code span.va { color: #000000; } /* Variable */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.ex { } /* Extension */
code span.at { color: #c4a000; } /* Attribute */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">London Underground</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="ManagingData.html">Managing Data</a>
</li>
<li>
  <a href="VisualisingData.html">Visualising Data</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-gear"></span>
     
    Analysis
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">R</li>
    <li>
      <a href="GetData.html">Download Data</a>
    </li>
    <li>
      <a href="GetTablesFromXPaths.html">Scraping</a>
    </li>
    <li>
      <a href="VariableCreation.html">Variable Creation</a>
    </li>
    <li>
      <a href="SQLTables.html">SQL Upload</a>
    </li>
    <li>
      <a href="FeatherUpload.html">Feather Upload</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Python</li>
    <li>
      <a href="XMLParsing.html">Scraping</a>
    </li>
    <li>
      <a href="TfLTimetable.html">TfL Timetable Class</a>
    </li>
    <li>
      <a href="ShortestPath.html">Shortest Path</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">SQL</li>
    <li>
      <a href="InboundGraph.html">Inbound Graph</a>
    </li>
    <li>
      <a href="DepartureBoard.html">Departure Board</a>
    </li>
    <li>
      <a href="DaysOfWeekGroups.html">Days of Week Groups</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Workflow</li>
    <li>
      <a href="PrepareData.html">Prepare Data</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ruaridhw">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">




</div>


<div id="tfl-timetable" class="section level1">
<h1>TfL Timetable</h1>
<p>This file provides a custom class for parsing the UK Department for Transport TransXChange schema used across the country for representing train, bus, ferry, tube and light rail timetable data.</p>
<p>The logic provided here has been tested on the tube timetables only however the schema is identical across transport modes and should be highly portable.</p>
<p>To see how to call this class see the <code>Main()</code> function in <a href="XMLParsing.html">XMLParsing.py</a>.</p>
</div>
<div id="class" class="section level1">
<h1>Class</h1>
<p>The class is based on the ElementTree object and is initialised from the file path to an XML timetable file.</p>
<p>It contains a number of methods for parsing data, the primary interface being <code>get_df</code> which calls the other methods as required.</p>
<p>The final part of the class defines the XPaths to various data points found in the timetable. Not every data point in every timetable has been defined so these can be added if necessary.</p>
<p><a href="https://github.com/ruaridhw/london-tube/blob/master/2_analysis/python/TfLTimetable.py">Source code</a></p>
<pre class="sourceCode python" id="cb1"><code class="sourceCode python"><div class="sourceLine" id="cb1-1" data-line-number="1"><span class="im">import</span> pandas <span class="im">as</span> pd</div>
<div class="sourceLine" id="cb1-2" data-line-number="2"><span class="im">from</span> lxml <span class="im">import</span> etree</div>
<div class="sourceLine" id="cb1-3" data-line-number="3"></div>
<div class="sourceLine" id="cb1-4" data-line-number="4">_DEBUG_ <span class="op">=</span> <span class="va">False</span></div>
<div class="sourceLine" id="cb1-5" data-line-number="5"></div>
<div class="sourceLine" id="cb1-6" data-line-number="6"><span class="kw">class</span> TfLTimetable(etree._ElementTree):</div>
<div class="sourceLine" id="cb1-7" data-line-number="7">    <span class="co"># Define TransXChange schema namespace</span></div>
<div class="sourceLine" id="cb1-8" data-line-number="8">    ns <span class="op">=</span> {<span class="st">&#39;txc&#39;</span>: <span class="st">&#39;http://www.transxchange.org.uk/&#39;</span>}</div>
<div class="sourceLine" id="cb1-9" data-line-number="9">    </div>
<div class="sourceLine" id="cb1-10" data-line-number="10">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, <span class="bu">file</span>):</div>
<div class="sourceLine" id="cb1-11" data-line-number="11">        <span class="co">&quot;&quot;&quot;</span></div>
<div class="sourceLine" id="cb1-12" data-line-number="12"><span class="co">            Initialise as an ElementTree object from the</span></div>
<div class="sourceLine" id="cb1-13" data-line-number="13"><span class="co">            path to a TransXChange Timetable XML file</span></div>
<div class="sourceLine" id="cb1-14" data-line-number="14"><span class="co">        &quot;&quot;&quot;</span></div>
<div class="sourceLine" id="cb1-15" data-line-number="15">        <span class="va">self</span>.parse(<span class="bu">file</span>)</div></code></pre>
<div id="methods" class="section level2">
<h2>Methods</h2>
<pre class="sourceCode r" id="cb2"><code class="sourceCode r"><div class="sourceLine" id="cb2-1" data-line-number="1">    def <span class="kw">get_xpath</span>(self, path)<span class="op">:</span></div>
<div class="sourceLine" id="cb2-2" data-line-number="2"><span class="st">        &quot;&quot;&quot;</span></div>
<div class="sourceLine" id="cb2-3" data-line-number="3"><span class="st">            path   An XPath</span></div>
<div class="sourceLine" id="cb2-4" data-line-number="4"><span class="st">            </span></div>
<div class="sourceLine" id="cb2-5" data-line-number="5"><span class="st">            Simple wrapper for xpath method that includes</span></div>
<div class="sourceLine" id="cb2-6" data-line-number="6"><span class="st">            the required TransXChange namespace</span></div>
<div class="sourceLine" id="cb2-7" data-line-number="7"><span class="st">            </span></div>
<div class="sourceLine" id="cb2-8" data-line-number="8"><span class="st">            Returns a list of all XPath matches</span></div>
<div class="sourceLine" id="cb2-9" data-line-number="9"><span class="st">        &quot;&quot;&quot;</span></div>
<div class="sourceLine" id="cb2-10" data-line-number="10">        return <span class="kw">self.xpath</span>(path, <span class="dt">namespaces=</span>self.ns)</div>
<div class="sourceLine" id="cb2-11" data-line-number="11">    </div>
<div class="sourceLine" id="cb2-12" data-line-number="12">    def <span class="kw">get_tag</span>(self, e)<span class="op">:</span></div>
<div class="sourceLine" id="cb2-13" data-line-number="13"><span class="st">        &quot;&quot;&quot;</span></div>
<div class="sourceLine" id="cb2-14" data-line-number="14"><span class="st">            e      An lxml node element</span></div>
<div class="sourceLine" id="cb2-15" data-line-number="15"><span class="st">            </span></div>
<div class="sourceLine" id="cb2-16" data-line-number="16"><span class="st">            Simple wrapper for returning a tag name</span></div>
<div class="sourceLine" id="cb2-17" data-line-number="17"><span class="st">            without the namespace information</span></div>
<div class="sourceLine" id="cb2-18" data-line-number="18"><span class="st">            </span></div>
<div class="sourceLine" id="cb2-19" data-line-number="19"><span class="st">            Returns the tag name as a string</span></div>
<div class="sourceLine" id="cb2-20" data-line-number="20"><span class="st">        &quot;&quot;&quot;</span></div>
<div class="sourceLine" id="cb2-21" data-line-number="21">        return <span class="kw">e.tag.lstrip</span>(<span class="st">&#39;{&#39;</span><span class="op">+</span>self.ns[<span class="st">&#39;txc&#39;</span>]<span class="op">+</span><span class="st">&#39;}&#39;</span>)</div>
<div class="sourceLine" id="cb2-22" data-line-number="22"></div>
<div class="sourceLine" id="cb2-23" data-line-number="23">    def <span class="kw">get_varying_child_tags</span>(self, path)<span class="op">:</span></div>
<div class="sourceLine" id="cb2-24" data-line-number="24"><span class="st">        &quot;&quot;&quot;</span></div>
<div class="sourceLine" id="cb2-25" data-line-number="25"><span class="st">            path    The XPath to an Operating Profile node.</span></div>
<div class="sourceLine" id="cb2-26" data-line-number="26"><span class="st">                    See TfLTimetable.op_prof_paths</span></div>
<div class="sourceLine" id="cb2-27" data-line-number="27"><span class="st">            </span></div>
<div class="sourceLine" id="cb2-28" data-line-number="28"><span class="st">            These nodes contain a varying number of nested child tags</span></div>
<div class="sourceLine" id="cb2-29" data-line-number="29"><span class="st">            so it is necessary to extract the tag names of each</span></div>
<div class="sourceLine" id="cb2-30" data-line-number="30"><span class="st">            tag that is present and match it to an id_value found</span></div>
<div class="sourceLine" id="cb2-31" data-line-number="31"><span class="st">            in a specific parent tag (defined for each type of XPath;</span></div>
<div class="sourceLine" id="cb2-32" data-line-number="32"><span class="st">            VehicleJourney or Service).</span></div>
<div class="sourceLine" id="cb2-33" data-line-number="33"><span class="st">            </span></div>
<div class="sourceLine" id="cb2-34" data-line-number="34"><span class="st">            Returns a dictionary of DataFrames where each item is a</span></div>
<div class="sourceLine" id="cb2-35" data-line-number="35"><span class="st">            particular profile (RegularDayType, BankHolidayOperation, ...)</span></div>
<div class="sourceLine" id="cb2-36" data-line-number="36"><span class="st">            Each DataFrame contains two columns: the id_value repetitively</span></div>
<div class="sourceLine" id="cb2-37" data-line-number="37"><span class="st">            listed against each child tag found for that id.</span></div>
<div class="sourceLine" id="cb2-38" data-line-number="38"><span class="st">        &quot;&quot;&quot;</span></div>
<div class="sourceLine" id="cb2-39" data-line-number="39"></div>
<div class="sourceLine" id="cb2-40" data-line-number="40">        tables =<span class="st"> </span>{}</div>
<div class="sourceLine" id="cb2-41" data-line-number="41">        colnames =<span class="st"> </span>{}</div>
<div class="sourceLine" id="cb2-42" data-line-number="42">        <span class="cf">for</span> e <span class="cf">in</span> <span class="kw">self.get_xpath</span>(path)<span class="op">:</span></div>
<div class="sourceLine" id="cb2-43" data-line-number="43"></div>
<div class="sourceLine" id="cb2-44" data-line-number="44"><span class="st">            </span>id_parent =<span class="st"> </span><span class="kw">e.getparent</span>()<span class="kw">.getparent</span>()</div>
<div class="sourceLine" id="cb2-45" data-line-number="45"></div>
<div class="sourceLine" id="cb2-46" data-line-number="46">            <span class="co"># Extract the relevant id to store the extracted child tags against</span></div>
<div class="sourceLine" id="cb2-47" data-line-number="47">            <span class="cf">if</span> <span class="st">&#39;VehicleJourney&#39;</span> <span class="cf">in</span> id_parent.tag<span class="op">:</span></div>
<div class="sourceLine" id="cb2-48" data-line-number="48"><span class="st">                </span>id_value =<span class="st"> </span>id_parent[<span class="dv">3</span>].text <span class="co"># VehicleJourneyCode is the 4th node of the parent</span></div>
<div class="sourceLine" id="cb2-49" data-line-number="49">                category =<span class="st"> &#39;VehicleJourneys&#39;</span></div>
<div class="sourceLine" id="cb2-50" data-line-number="50">            elif <span class="st">&#39;Service&#39;</span> <span class="cf">in</span> id_parent.tag<span class="op">:</span></div>
<div class="sourceLine" id="cb2-51" data-line-number="51"><span class="st">                </span>id_value =<span class="st"> </span>id_parent[<span class="dv">0</span>].text <span class="co"># ServiceCode is the 1st node of the parent</span></div>
<div class="sourceLine" id="cb2-52" data-line-number="52">                category =<span class="st"> &#39;Services&#39;</span></div>
<div class="sourceLine" id="cb2-53" data-line-number="53">            <span class="cf">else</span><span class="op">:</span></div>
<div class="sourceLine" id="cb2-54" data-line-number="54"><span class="st">                </span>raise <span class="kw">ValueError</span>(<span class="st">&#39;This XPath is not yet supported&#39;</span>)</div>
<div class="sourceLine" id="cb2-55" data-line-number="55"></div>
<div class="sourceLine" id="cb2-56" data-line-number="56">            <span class="cf">if</span> _DEBUG_<span class="op">:</span><span class="st"> </span><span class="kw">print</span>(id_value)</div>
<div class="sourceLine" id="cb2-57" data-line-number="57"></div>
<div class="sourceLine" id="cb2-58" data-line-number="58">            <span class="co"># Loop through the types of profiles (RegularDayType, BankHolidayOperation, ...)</span></div>
<div class="sourceLine" id="cb2-59" data-line-number="59">            <span class="co"># creating a new table and column names for each</span></div>
<div class="sourceLine" id="cb2-60" data-line-number="60">            <span class="cf">for</span> profile <span class="cf">in</span> e<span class="op">:</span></div>
<div class="sourceLine" id="cb2-61" data-line-number="61"><span class="st">                </span>tablename =<span class="st"> </span>category <span class="op">+</span><span class="st"> &#39;_&#39;</span> <span class="op">+</span><span class="st"> </span><span class="kw">self.get_tag</span>(<span class="kw">profile.getparent</span>()) <span class="op">+</span><span class="st"> &#39;_&#39;</span> <span class="op">+</span><span class="st"> </span>\</div>
<div class="sourceLine" id="cb2-62" data-line-number="62">                    <span class="kw">self.get_tag</span>(profile)</div>
<div class="sourceLine" id="cb2-63" data-line-number="63">                colnames[tablename] =<span class="st"> </span>[category, <span class="kw">self.get_tag</span>(profile)]</div>
<div class="sourceLine" id="cb2-64" data-line-number="64"></div>
<div class="sourceLine" id="cb2-65" data-line-number="65">                <span class="cf">if</span> _DEBUG_<span class="op">:</span><span class="st"> </span><span class="kw">print</span>(col_name)</div>
<div class="sourceLine" id="cb2-66" data-line-number="66"></div>
<div class="sourceLine" id="cb2-67" data-line-number="67">                <span class="co"># Loop through the child tags extracting out the tag name and adding</span></div>
<div class="sourceLine" id="cb2-68" data-line-number="68">                <span class="co"># it to the newly created table</span></div>
<div class="sourceLine" id="cb2-69" data-line-number="69">                <span class="cf">for</span> child <span class="cf">in</span> <span class="kw">profile.iterchildren</span>()<span class="op">:</span></div>
<div class="sourceLine" id="cb2-70" data-line-number="70"><span class="st">                    </span>cell_value =<span class="st"> </span><span class="kw">self.get_tag</span>(child)</div>
<div class="sourceLine" id="cb2-71" data-line-number="71"></div>
<div class="sourceLine" id="cb2-72" data-line-number="72">                    <span class="cf">if</span> tablename not <span class="cf">in</span> tables<span class="op">:</span></div>
<div class="sourceLine" id="cb2-73" data-line-number="73"><span class="st">                        </span>tables[tablename] =<span class="st"> </span>[(id_value, cell_value)]</div>
<div class="sourceLine" id="cb2-74" data-line-number="74">                    <span class="cf">else</span><span class="op">:</span></div>
<div class="sourceLine" id="cb2-75" data-line-number="75"><span class="st">                        </span>tables[tablename]<span class="kw">.append</span>((id_value, cell_value))</div>
<div class="sourceLine" id="cb2-76" data-line-number="76"></div>
<div class="sourceLine" id="cb2-77" data-line-number="77">                    <span class="cf">if</span> _DEBUG_<span class="op">:</span><span class="st"> </span><span class="kw">print</span>(cell_value)</div>
<div class="sourceLine" id="cb2-78" data-line-number="78"></div>
<div class="sourceLine" id="cb2-79" data-line-number="79">        <span class="co"># Store DataFrame in dictionary keyed by tablename</span></div>
<div class="sourceLine" id="cb2-80" data-line-number="80">        <span class="cf">for</span> tablename, data <span class="cf">in</span> <span class="kw">tables.items</span>()<span class="op">:</span></div>
<div class="sourceLine" id="cb2-81" data-line-number="81"><span class="st">            </span>tables[tablename] =<span class="st"> </span><span class="kw">pd.DataFrame.from_records</span>(data, <span class="dt">columns =</span> colnames[tablename])</div>
<div class="sourceLine" id="cb2-82" data-line-number="82"></div>
<div class="sourceLine" id="cb2-83" data-line-number="83">        return tables</div>
<div class="sourceLine" id="cb2-84" data-line-number="84"></div>
<div class="sourceLine" id="cb2-85" data-line-number="85">    def <span class="kw">get_occasional_child_node</span>(self, path)<span class="op">:</span></div>
<div class="sourceLine" id="cb2-86" data-line-number="86"><span class="st">        &quot;&quot;&quot;</span></div>
<div class="sourceLine" id="cb2-87" data-line-number="87"><span class="st">            path    The XPath to a node that is sometimes missing</span></div>
<div class="sourceLine" id="cb2-88" data-line-number="88"><span class="st">            </span></div>
<div class="sourceLine" id="cb2-89" data-line-number="89"><span class="st">            This function is called if a tilde is found in the</span></div>
<div class="sourceLine" id="cb2-90" data-line-number="90"><span class="st">            XPath. Though not a valid XPath character it is used here</span></div>
<div class="sourceLine" id="cb2-91" data-line-number="91"><span class="st">            to signify a call to this function and then removed.</span></div>
<div class="sourceLine" id="cb2-92" data-line-number="92"><span class="st">            </span></div>
<div class="sourceLine" id="cb2-93" data-line-number="93"><span class="st">            An example of an occasional child node is the WaitTime</span></div>
<div class="sourceLine" id="cb2-94" data-line-number="94"><span class="st">            at a station. If a train has no WaitTime at a station then</span></div>
<div class="sourceLine" id="cb2-95" data-line-number="95"><span class="st">            the node does not appear so this function handles the XPath</span></div>
<div class="sourceLine" id="cb2-96" data-line-number="96"><span class="st">            not necessarily existing.</span></div>
<div class="sourceLine" id="cb2-97" data-line-number="97"><span class="st">            </span></div>
<div class="sourceLine" id="cb2-98" data-line-number="98"><span class="st">            This has to be extracted manually because etree.xpath returns</span></div>
<div class="sourceLine" id="cb2-99" data-line-number="99"><span class="st">            a list of results so there is no way to match the missing values</span></div>
<div class="sourceLine" id="cb2-100" data-line-number="100"><span class="st">            back to their ids otherwise.</span></div>
<div class="sourceLine" id="cb2-101" data-line-number="101"><span class="st">            </span></div>
<div class="sourceLine" id="cb2-102" data-line-number="102"><span class="st">            Returns a list of extracted values equal in length to the</span></div>
<div class="sourceLine" id="cb2-103" data-line-number="103"><span class="st">            number of matches of path_parent (and therefore does not squash</span></div>
<div class="sourceLine" id="cb2-104" data-line-number="104"><span class="st">            missing values).</span></div>
<div class="sourceLine" id="cb2-105" data-line-number="105"><span class="st">        &quot;&quot;&quot;</span></div>
<div class="sourceLine" id="cb2-106" data-line-number="106">        path_parent, path_child =<span class="st"> </span><span class="kw">path.split</span>(<span class="st">&#39;~&#39;</span>)</div>
<div class="sourceLine" id="cb2-107" data-line-number="107">        col =<span class="st"> </span>[]</div>
<div class="sourceLine" id="cb2-108" data-line-number="108">        <span class="cf">for</span> node <span class="cf">in</span> <span class="kw">self.get_xpath</span>(path_parent)<span class="op">:</span></div>
<div class="sourceLine" id="cb2-109" data-line-number="109"><span class="st">            </span>val =<span class="st"> </span><span class="kw">node.xpath</span>(path_child, <span class="dt">namespaces=</span>self.ns)</div>
<div class="sourceLine" id="cb2-110" data-line-number="110">            <span class="co"># val is a list with only ever 0 or one elements</span></div>
<div class="sourceLine" id="cb2-111" data-line-number="111">            <span class="kw">col.append</span>(val[<span class="dv">0</span>] <span class="cf">if</span> <span class="kw">len</span>(val) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> <span class="cf">else</span> None)</div>
<div class="sourceLine" id="cb2-112" data-line-number="112">        return col</div>
<div class="sourceLine" id="cb2-113" data-line-number="113"></div>
<div class="sourceLine" id="cb2-114" data-line-number="114">    def <span class="kw">get_df</span>(self, dict_of_paths)<span class="op">:</span></div>
<div class="sourceLine" id="cb2-115" data-line-number="115"><span class="st">        &quot;&quot;&quot;</span></div>
<div class="sourceLine" id="cb2-116" data-line-number="116"><span class="st">            dict_of_paths    A dictionary of XPaths all corresponding</span></div>
<div class="sourceLine" id="cb2-117" data-line-number="117"><span class="st">                             to a single table and should therefore be</span></div>
<div class="sourceLine" id="cb2-118" data-line-number="118"><span class="st">                             equal in the number of returned rows for</span></div>
<div class="sourceLine" id="cb2-119" data-line-number="119"><span class="st">                             each path.</span></div>
<div class="sourceLine" id="cb2-120" data-line-number="120"><span class="st">                             See TfLTimetable.NptgLocalities et al.</span></div>
<div class="sourceLine" id="cb2-121" data-line-number="121"><span class="st">            </span></div>
<div class="sourceLine" id="cb2-122" data-line-number="122"><span class="st">            Dispatches Case 1, 2 or 3 depending on any special characters</span></div>
<div class="sourceLine" id="cb2-123" data-line-number="123"><span class="st">            foun in the incumbent XPath.</span></div>
<div class="sourceLine" id="cb2-124" data-line-number="124"><span class="st">            </span></div>
<div class="sourceLine" id="cb2-125" data-line-number="125"><span class="st">            Returns a single dataframe where each column corresponds to</span></div>
<div class="sourceLine" id="cb2-126" data-line-number="126"><span class="st">            the keys of dict_of_paths</span></div>
<div class="sourceLine" id="cb2-127" data-line-number="127"><span class="st">        &quot;&quot;&quot;</span></div>
<div class="sourceLine" id="cb2-128" data-line-number="128">        cols =<span class="st"> </span>[]</div>
<div class="sourceLine" id="cb2-129" data-line-number="129">        <span class="cf">for</span> var, path <span class="cf">in</span> <span class="kw">dict_of_paths.items</span>()<span class="op">:</span></div>
<div class="sourceLine" id="cb2-130" data-line-number="130"><span class="st">            </span></div>
<div class="sourceLine" id="cb2-131" data-line-number="131"><span class="st">            </span><span class="co"># Case 1: Tag may or may not exist.</span></div>
<div class="sourceLine" id="cb2-132" data-line-number="132"><span class="st">            </span><span class="co">#         ~ is not a valid XPath character but is used to manually</span></div>
<div class="sourceLine" id="cb2-133" data-line-number="133"><span class="st">            </span><span class="co">#         indicate a call to Case 1</span></div>
<div class="sourceLine" id="cb2-134" data-line-number="134"><span class="st">            </span><span class="cf">if</span> <span class="st">&#39;~&#39;</span> <span class="cf">in</span> path<span class="op">:</span></div>
<div class="sourceLine" id="cb2-135" data-line-number="135"><span class="st">                </span><span class="kw">cols.append</span>((var, <span class="kw">self.get_occasional_child_node</span>(path)))</div>
<div class="sourceLine" id="cb2-136" data-line-number="136">            </div>
<div class="sourceLine" id="cb2-137" data-line-number="137">            <span class="co"># Case 2: Return a column for the id attribute of the parent node</span></div>
<div class="sourceLine" id="cb2-138" data-line-number="138">            <span class="co">#         with the same length as the number of siblings.</span></div>
<div class="sourceLine" id="cb2-139" data-line-number="139">            <span class="co">#         parent::node() is not a valid XPath expression in this context</span></div>
<div class="sourceLine" id="cb2-140" data-line-number="140">            <span class="co">#         but is used to manually indicate a call to Case 2</span></div>
<div class="sourceLine" id="cb2-141" data-line-number="141">            elif <span class="kw">path.endswith</span>(<span class="st">&#39;parent::node()&#39;</span>)<span class="op">:</span></div>
<div class="sourceLine" id="cb2-142" data-line-number="142"><span class="st">                </span>nodes =<span class="st"> </span><span class="kw">self.get_xpath</span>(<span class="kw">path.rstrip</span>(<span class="st">&#39;/parent::node()&#39;</span>))</div>
<div class="sourceLine" id="cb2-143" data-line-number="143">                <span class="kw">cols.append</span>((var, [<span class="kw">node.getparent</span>()<span class="kw">.get</span>(<span class="st">&#39;id&#39;</span>) <span class="cf">for</span> node <span class="cf">in</span> nodes]))</div>
<div class="sourceLine" id="cb2-144" data-line-number="144">            </div>
<div class="sourceLine" id="cb2-145" data-line-number="145">            <span class="co"># Case 3: Return a column for XPath values</span></div>
<div class="sourceLine" id="cb2-146" data-line-number="146">            <span class="cf">else</span><span class="op">:</span></div>
<div class="sourceLine" id="cb2-147" data-line-number="147"><span class="st">                </span><span class="kw">cols.append</span>((var, <span class="kw">self.get_xpath</span>(path)))</div>
<div class="sourceLine" id="cb2-148" data-line-number="148">            </div>
<div class="sourceLine" id="cb2-149" data-line-number="149">        df =<span class="st"> </span><span class="kw">pd.DataFrame.from_items</span>(cols)</div>
<div class="sourceLine" id="cb2-150" data-line-number="150">        return df</div></code></pre>
</div>
<div id="xpaths" class="section level2">
<h2>XPaths</h2>
<p>Contains the XPath definitions of the columns for each table within a TransXChange XML file. Currently omits tables and columns which are not relevant to London Underground timetables</p>
<pre class="sourceCode r" id="cb3"><code class="sourceCode r"><div class="sourceLine" id="cb3-1" data-line-number="1">    <span class="co"># NptgLocalities</span></div>
<div class="sourceLine" id="cb3-2" data-line-number="2">    root_localities =<span class="st"> &quot;./txc:NptgLocalities/txc:AnnotatedNptgLocalityRef&quot;</span></div>
<div class="sourceLine" id="cb3-3" data-line-number="3">    NptgLocalities =<span class="st"> </span>{</div>
<div class="sourceLine" id="cb3-4" data-line-number="4">        <span class="st">&quot;NptgLocalityRef&quot;</span><span class="op">:</span><span class="st"> </span>root_localities <span class="op">+</span><span class="st"> &quot;/txc:NptgLocalityRef/text()&quot;</span>,</div>
<div class="sourceLine" id="cb3-5" data-line-number="5">        <span class="st">&quot;LocalityName&quot;</span><span class="op">:</span><span class="st"> </span>root_localities <span class="op">+</span><span class="st"> &quot;/txc:LocalityName/text()&quot;</span></div>
<div class="sourceLine" id="cb3-6" data-line-number="6">    }</div>
<div class="sourceLine" id="cb3-7" data-line-number="7"></div>
<div class="sourceLine" id="cb3-8" data-line-number="8">    <span class="co"># StopPoints</span></div>
<div class="sourceLine" id="cb3-9" data-line-number="9">    root_stops =<span class="st"> &quot;./txc:StopPoints/txc:StopPoint&quot;</span></div>
<div class="sourceLine" id="cb3-10" data-line-number="10">    StopPoints =<span class="st"> </span>{</div>
<div class="sourceLine" id="cb3-11" data-line-number="11">        <span class="st">&quot;AtcoCode&quot;</span><span class="op">:</span><span class="st"> </span>root_stops <span class="op">+</span><span class="st"> &quot;/txc:AtcoCode/text()&quot;</span>,</div>
<div class="sourceLine" id="cb3-12" data-line-number="12">        <span class="st">&quot;Descriptor_CommonName&quot;</span><span class="op">:</span><span class="st"> </span>root_stops <span class="op">+</span><span class="st"> &quot;/txc:Descriptor/txc:CommonName/text()&quot;</span>,</div>
<div class="sourceLine" id="cb3-13" data-line-number="13">        <span class="st">&quot;Place_NptgLocalityRef&quot;</span><span class="op">:</span><span class="st"> </span>root_stops <span class="op">+</span><span class="st"> &quot;/txc:Place/txc:NptgLocalityRef/text()&quot;</span>,</div>
<div class="sourceLine" id="cb3-14" data-line-number="14">        <span class="st">&quot;Place_Location_Easting&quot;</span><span class="op">:</span><span class="st"> </span>root_stops <span class="op">+</span><span class="st"> &quot;/txc:Place/txc:Location/txc:Easting/text()&quot;</span>,</div>
<div class="sourceLine" id="cb3-15" data-line-number="15">        <span class="st">&quot;Place_Location_Northing&quot;</span><span class="op">:</span><span class="st"> </span>root_stops <span class="op">+</span><span class="st"> &quot;/txc:Place/txc:Location/txc:Northing/text()&quot;</span>,</div>
<div class="sourceLine" id="cb3-16" data-line-number="16">    }</div>
<div class="sourceLine" id="cb3-17" data-line-number="17"></div>
<div class="sourceLine" id="cb3-18" data-line-number="18">    <span class="co"># RouteSections and RouteLinks</span></div>
<div class="sourceLine" id="cb3-19" data-line-number="19">    root_routelinks =<span class="st"> &quot;./txc:RouteSections/txc:RouteSection/txc:RouteLink&quot;</span></div>
<div class="sourceLine" id="cb3-20" data-line-number="20">    RouteLinks =<span class="st"> </span>{</div>
<div class="sourceLine" id="cb3-21" data-line-number="21">        <span class="st">&quot;RouteSections&quot;</span><span class="op">:</span><span class="st"> </span>root_routelinks <span class="op">+</span><span class="st"> &quot;/parent::node()&quot;</span>,</div>
<div class="sourceLine" id="cb3-22" data-line-number="22">        <span class="st">&quot;RouteLink&quot;</span><span class="op">:</span><span class="st"> </span>root_routelinks <span class="op">+</span><span class="st"> &quot;/@id&quot;</span>,</div>
<div class="sourceLine" id="cb3-23" data-line-number="23">        <span class="st">&quot;From_StopPointRef&quot;</span><span class="op">:</span><span class="st"> </span>root_routelinks <span class="op">+</span><span class="st"> &quot;/txc:From/txc:StopPointRef/text()&quot;</span>,</div>
<div class="sourceLine" id="cb3-24" data-line-number="24">        <span class="st">&quot;To_StopPointRef&quot;</span><span class="op">:</span><span class="st"> </span>root_routelinks <span class="op">+</span><span class="st"> &quot;/txc:To/txc:StopPointRef/text()&quot;</span>,</div>
<div class="sourceLine" id="cb3-25" data-line-number="25">        <span class="st">&quot;Distance&quot;</span><span class="op">:</span><span class="st"> </span>root_routelinks <span class="op">+</span><span class="st"> &quot;~txc:Distance/text()&quot;</span>,</div>
<div class="sourceLine" id="cb3-26" data-line-number="26">        <span class="st">&quot;Direction&quot;</span><span class="op">:</span><span class="st"> </span>root_routelinks <span class="op">+</span><span class="st"> &quot;/txc:Direction/text()&quot;</span>,</div>
<div class="sourceLine" id="cb3-27" data-line-number="27">    }</div>
<div class="sourceLine" id="cb3-28" data-line-number="28"></div>
<div class="sourceLine" id="cb3-29" data-line-number="29">    <span class="co"># Routes</span></div>
<div class="sourceLine" id="cb3-30" data-line-number="30">    root_routes =<span class="st"> &quot;./txc:Routes/txc:Route&quot;</span></div>
<div class="sourceLine" id="cb3-31" data-line-number="31">    Routes =<span class="st"> </span>{</div>
<div class="sourceLine" id="cb3-32" data-line-number="32">        <span class="st">&quot;Route&quot;</span><span class="op">:</span><span class="st"> </span>root_routes <span class="op">+</span><span class="st"> &quot;/@id&quot;</span>,</div>
<div class="sourceLine" id="cb3-33" data-line-number="33">        <span class="st">&quot;Description&quot;</span><span class="op">:</span><span class="st"> </span>root_routes <span class="op">+</span><span class="st"> &quot;/txc:Description/text()&quot;</span>,</div>
<div class="sourceLine" id="cb3-34" data-line-number="34">        <span class="st">&quot;RouteSectionRef&quot;</span><span class="op">:</span><span class="st"> </span>root_routes <span class="op">+</span><span class="st"> &quot;/txc:RouteSectionRef/text()&quot;</span>,</div>
<div class="sourceLine" id="cb3-35" data-line-number="35">    }</div>
<div class="sourceLine" id="cb3-36" data-line-number="36"></div>
<div class="sourceLine" id="cb3-37" data-line-number="37">    <span class="co"># JourneyPatternSections and JourneyPatternTimingLink</span></div>
<div class="sourceLine" id="cb3-38" data-line-number="38">    root_journeysections =<span class="st"> &quot;./txc:JourneyPatternSections/txc:JourneyPatternSection/txc:JourneyPatternTimingLink&quot;</span></div>
<div class="sourceLine" id="cb3-39" data-line-number="39">    JourneyPatternTimingLinks =<span class="st"> </span>{</div>
<div class="sourceLine" id="cb3-40" data-line-number="40">        <span class="st">&quot;JourneyPatternSections&quot;</span><span class="op">:</span><span class="st"> </span>root_journeysections <span class="op">+</span><span class="st"> &quot;/parent::node()&quot;</span>,</div>
<div class="sourceLine" id="cb3-41" data-line-number="41">        <span class="st">&quot;JourneyPatternTimingLink&quot;</span><span class="op">:</span><span class="st"> </span>root_journeysections <span class="op">+</span><span class="st"> &quot;/@id&quot;</span>,</div>
<div class="sourceLine" id="cb3-42" data-line-number="42">        <span class="st">&quot;From_SequenceNumber&quot;</span><span class="op">:</span><span class="st"> </span>root_journeysections <span class="op">+</span><span class="st"> &quot;/txc:From/@SequenceNumber&quot;</span>,</div>
<div class="sourceLine" id="cb3-43" data-line-number="43">        <span class="st">&quot;From_Activity&quot;</span><span class="op">:</span><span class="st"> </span>root_journeysections <span class="op">+</span><span class="st"> &quot;/txc:From/txc:Activity/text()&quot;</span>,</div>
<div class="sourceLine" id="cb3-44" data-line-number="44">        <span class="st">&quot;From_StopPointRef&quot;</span><span class="op">:</span><span class="st"> </span>root_journeysections <span class="op">+</span><span class="st"> &quot;/txc:From/txc:StopPointRef/text()&quot;</span>,</div>
<div class="sourceLine" id="cb3-45" data-line-number="45">        <span class="st">&quot;To_SequenceNumber&quot;</span><span class="op">:</span><span class="st"> </span>root_journeysections <span class="op">+</span><span class="st"> &quot;/txc:To/@SequenceNumber&quot;</span>,</div>
<div class="sourceLine" id="cb3-46" data-line-number="46">        <span class="st">&quot;To_Activity&quot;</span><span class="op">:</span><span class="st"> </span>root_journeysections <span class="op">+</span><span class="st"> &quot;/txc:To/txc:Activity/text()&quot;</span>,</div>
<div class="sourceLine" id="cb3-47" data-line-number="47">        <span class="st">&quot;To_StopPointRef&quot;</span><span class="op">:</span><span class="st"> </span>root_journeysections <span class="op">+</span><span class="st"> &quot;/txc:To/txc:StopPointRef/text()&quot;</span>,</div>
<div class="sourceLine" id="cb3-48" data-line-number="48">        <span class="st">&quot;RouteLinkRef&quot;</span><span class="op">:</span><span class="st"> </span>root_journeysections <span class="op">+</span><span class="st"> &quot;/txc:RouteLinkRef/text()&quot;</span>,</div>
<div class="sourceLine" id="cb3-49" data-line-number="49">        <span class="st">&quot;RunTime&quot;</span><span class="op">:</span><span class="st"> </span>root_journeysections <span class="op">+</span><span class="st"> &quot;/txc:RunTime/text()&quot;</span>,</div>
<div class="sourceLine" id="cb3-50" data-line-number="50">        <span class="st">&quot;WaitTime&quot;</span><span class="op">:</span><span class="st"> </span>root_journeysections <span class="op">+</span><span class="st"> &quot;/txc:To~txc:WaitTime/text()&quot;</span>, <span class="co"># invalid xpath, used to distinguish from generic node</span></div>
<div class="sourceLine" id="cb3-51" data-line-number="51">    }</div>
<div class="sourceLine" id="cb3-52" data-line-number="52"></div>
<div class="sourceLine" id="cb3-53" data-line-number="53">    <span class="co"># Services</span></div>
<div class="sourceLine" id="cb3-54" data-line-number="54">    root_services =<span class="st"> &quot;./txc:Services/txc:Service&quot;</span></div>
<div class="sourceLine" id="cb3-55" data-line-number="55">    Services =<span class="st"> </span>{</div>
<div class="sourceLine" id="cb3-56" data-line-number="56">        <span class="st">&quot;ServiceCode&quot;</span><span class="op">:</span><span class="st"> </span>root_services <span class="op">+</span><span class="st"> &quot;/txc:ServiceCode/text()&quot;</span>,</div>
<div class="sourceLine" id="cb3-57" data-line-number="57">        <span class="st">&quot;Line&quot;</span><span class="op">:</span><span class="st"> </span>root_services <span class="op">+</span><span class="st"> &quot;/txc:Lines/txc:Line/@id&quot;</span>,</div>
<div class="sourceLine" id="cb3-58" data-line-number="58">        <span class="st">&quot;LineName&quot;</span><span class="op">:</span><span class="st"> </span>root_services <span class="op">+</span><span class="st"> &quot;/txc:Lines/txc:Line/txc:LineName/text()&quot;</span>,</div>
<div class="sourceLine" id="cb3-59" data-line-number="59">        <span class="st">&quot;OpPeriod_StartDate&quot;</span><span class="op">:</span><span class="st"> </span>root_services <span class="op">+</span><span class="st"> &quot;/txc:OperatingPeriod/txc:StartDate/text()&quot;</span>,</div>
<div class="sourceLine" id="cb3-60" data-line-number="60">        <span class="st">&quot;OpPeriod_EndDate&quot;</span><span class="op">:</span><span class="st"> </span>root_services <span class="op">+</span><span class="st"> &quot;/txc:OperatingPeriod/txc:EndDate/text()&quot;</span>,</div>
<div class="sourceLine" id="cb3-61" data-line-number="61">        <span class="co">#&quot;OpProf_DaysOfWeek&quot;: root_services + &quot;/txc:OperatingProfile/txc:RegularDayType/txc:DaysOfWeek&quot;,</span></div>
<div class="sourceLine" id="cb3-62" data-line-number="62">        <span class="co">#&quot;OpProf_Hol_DayofOp&quot;: root_services + &quot;/txc:OperatingProfile/txc:BankHolidayOperation/txc:DaysOfOperation&quot;,</span></div>
<div class="sourceLine" id="cb3-63" data-line-number="63">        <span class="co">#&quot;OpProf_Hol_DayofNonOp&quot;: root_services + &quot;/txc:OperatingProfile/txc:BankHolidayOperation/txc:DaysOfNonOperation&quot;,</span></div>
<div class="sourceLine" id="cb3-64" data-line-number="64">        <span class="st">&quot;Description&quot;</span><span class="op">:</span><span class="st"> </span>root_services <span class="op">+</span><span class="st"> &quot;/txc:Description/text()&quot;</span>,</div>
<div class="sourceLine" id="cb3-65" data-line-number="65">        <span class="st">&quot;StandardService_Origin&quot;</span><span class="op">:</span><span class="st"> </span>root_services <span class="op">+</span><span class="st"> &quot;/txc:StandardService/txc:Origin/text()&quot;</span>,</div>
<div class="sourceLine" id="cb3-66" data-line-number="66">        <span class="st">&quot;StandardService_Destination&quot;</span><span class="op">:</span><span class="st"> </span>root_services <span class="op">+</span><span class="st"> &quot;/txc:StandardService/txc:Destination/text()&quot;</span>,</div>
<div class="sourceLine" id="cb3-67" data-line-number="67">    }</div>
<div class="sourceLine" id="cb3-68" data-line-number="68">    ServicesOpProf =<span class="st"> </span>{</div>
<div class="sourceLine" id="cb3-69" data-line-number="69">        <span class="st">&quot;ServiceCode&quot;</span><span class="op">:</span><span class="st"> </span>root_services <span class="op">+</span><span class="st"> &quot;/txc:ServiceCode/text()&quot;</span>,</div>
<div class="sourceLine" id="cb3-70" data-line-number="70">        <span class="st">&quot;OpProf_DaysOfWeek&quot;</span><span class="op">:</span><span class="st"> </span>root_services <span class="op">+</span><span class="st"> &quot;/txc:OperatingProfile/txc:RegularDayType/txc:DaysOfWeek&quot;</span>,</div>
<div class="sourceLine" id="cb3-71" data-line-number="71">        <span class="st">&quot;OpProf_Hol_DayofOp&quot;</span><span class="op">:</span><span class="st"> </span>root_services <span class="op">+</span><span class="st"> &quot;/txc:OperatingProfile/txc:BankHolidayOperation/txc:DaysOfOperation&quot;</span>,</div>
<div class="sourceLine" id="cb3-72" data-line-number="72">        <span class="st">&quot;OpProf_Hol_DayofNonOp&quot;</span><span class="op">:</span><span class="st"> </span>root_services <span class="op">+</span><span class="st"> &quot;/txc:OperatingProfile/txc:BankHolidayOperation/txc:DaysOfNonOperation&quot;</span>,</div>
<div class="sourceLine" id="cb3-73" data-line-number="73">    }</div>
<div class="sourceLine" id="cb3-74" data-line-number="74"></div>
<div class="sourceLine" id="cb3-75" data-line-number="75">    <span class="co"># JourneyPatterns</span></div>
<div class="sourceLine" id="cb3-76" data-line-number="76">    root_journeypatterns =<span class="st"> &quot;./txc:Services/txc:Service/txc:StandardService/txc:JourneyPattern&quot;</span></div>
<div class="sourceLine" id="cb3-77" data-line-number="77">    JourneyPatterns =<span class="st"> </span>{</div>
<div class="sourceLine" id="cb3-78" data-line-number="78">        <span class="st">&quot;JourneyPattern&quot;</span><span class="op">:</span><span class="st"> </span>root_journeypatterns <span class="op">+</span><span class="st"> &quot;/@id&quot;</span>,</div>
<div class="sourceLine" id="cb3-79" data-line-number="79">        <span class="st">&quot;Direction&quot;</span><span class="op">:</span><span class="st"> </span>root_journeypatterns <span class="op">+</span><span class="st"> &quot;/txc:Direction/text()&quot;</span>,</div>
<div class="sourceLine" id="cb3-80" data-line-number="80">        <span class="st">&quot;RouteRef&quot;</span><span class="op">:</span><span class="st"> </span>root_journeypatterns <span class="op">+</span><span class="st"> &quot;/txc:RouteRef/text()&quot;</span>,</div>
<div class="sourceLine" id="cb3-81" data-line-number="81">        <span class="st">&quot;JourneyPatternSectionRefs&quot;</span><span class="op">:</span><span class="st"> </span>root_journeypatterns <span class="op">+</span><span class="st"> &quot;/txc:JourneyPatternSectionRefs/text()&quot;</span>,</div>
<div class="sourceLine" id="cb3-82" data-line-number="82">    }</div>
<div class="sourceLine" id="cb3-83" data-line-number="83"></div>
<div class="sourceLine" id="cb3-84" data-line-number="84">    <span class="co"># VehicleJourneys</span></div>
<div class="sourceLine" id="cb3-85" data-line-number="85">    root_vehiclejourneys =<span class="st"> &quot;./txc:VehicleJourneys/txc:VehicleJourney&quot;</span></div>
<div class="sourceLine" id="cb3-86" data-line-number="86">    VehicleJourneys =<span class="st"> </span>{</div>
<div class="sourceLine" id="cb3-87" data-line-number="87">        <span class="st">&quot;PrivateCode&quot;</span><span class="op">:</span><span class="st"> </span>root_vehiclejourneys <span class="op">+</span><span class="st"> &quot;/txc:PrivateCode/text()&quot;</span>,</div>
<div class="sourceLine" id="cb3-88" data-line-number="88">        <span class="co">#&quot;OpProf_DaysOfWeek&quot;: root_vehiclejourneys + &quot;/txc:OperatingProfile/txc:RegularDayType/txc:DaysOfWeek&quot;,</span></div>
<div class="sourceLine" id="cb3-89" data-line-number="89">        <span class="st">&quot;VehicleJourneyCode&quot;</span><span class="op">:</span><span class="st"> </span>root_vehiclejourneys <span class="op">+</span><span class="st"> &quot;/txc:VehicleJourneyCode/text()&quot;</span>,</div>
<div class="sourceLine" id="cb3-90" data-line-number="90">        <span class="st">&quot;ServiceRef&quot;</span><span class="op">:</span><span class="st"> </span>root_vehiclejourneys <span class="op">+</span><span class="st"> &quot;/txc:ServiceRef/text()&quot;</span>,</div>
<div class="sourceLine" id="cb3-91" data-line-number="91">        <span class="st">&quot;LineRef&quot;</span><span class="op">:</span><span class="st"> </span>root_vehiclejourneys <span class="op">+</span><span class="st"> &quot;/txc:LineRef/text()&quot;</span>,</div>
<div class="sourceLine" id="cb3-92" data-line-number="92">        <span class="st">&quot;JourneyPatternRef&quot;</span><span class="op">:</span><span class="st"> </span>root_vehiclejourneys <span class="op">+</span><span class="st"> &quot;/txc:JourneyPatternRef/text()&quot;</span>,</div>
<div class="sourceLine" id="cb3-93" data-line-number="93">        <span class="st">&quot;DepartureTime&quot;</span><span class="op">:</span><span class="st"> </span>root_vehiclejourneys <span class="op">+</span><span class="st"> &quot;/txc:DepartureTime/text()&quot;</span>,</div>
<div class="sourceLine" id="cb3-94" data-line-number="94">    }</div>
<div class="sourceLine" id="cb3-95" data-line-number="95">    VehicleJourneysOpProf =<span class="st"> </span>{</div>
<div class="sourceLine" id="cb3-96" data-line-number="96">        <span class="st">&quot;VehicleJourneyCode&quot;</span><span class="op">:</span><span class="st"> </span>root_vehiclejourneys <span class="op">+</span><span class="st"> &quot;/txc:VehicleJourneyCode/text()&quot;</span>,</div>
<div class="sourceLine" id="cb3-97" data-line-number="97">        <span class="st">&quot;OpProf_DaysOfWeek&quot;</span><span class="op">:</span><span class="st"> </span>root_vehiclejourneys <span class="op">+</span><span class="st"> &quot;/txc:OperatingProfile/txc:RegularDayType/txc:DaysOfWeek&quot;</span>,</div>
<div class="sourceLine" id="cb3-98" data-line-number="98">    }</div></code></pre>
<p>Dictionary collating all tables’ XPaths together</p>
<pre class="sourceCode r" id="cb4"><code class="sourceCode r"><div class="sourceLine" id="cb4-1" data-line-number="1">    required_xpaths =<span class="st"> </span>{</div>
<div class="sourceLine" id="cb4-2" data-line-number="2">        <span class="st">&quot;NptgLocalities&quot;</span><span class="op">:</span><span class="st"> </span>NptgLocalities,</div>
<div class="sourceLine" id="cb4-3" data-line-number="3">        <span class="st">&quot;StopPoints&quot;</span><span class="op">:</span><span class="st"> </span>StopPoints,</div>
<div class="sourceLine" id="cb4-4" data-line-number="4">        <span class="st">&quot;RouteLinks&quot;</span><span class="op">:</span><span class="st"> </span>RouteLinks,</div>
<div class="sourceLine" id="cb4-5" data-line-number="5">        <span class="st">&quot;Routes&quot;</span><span class="op">:</span><span class="st"> </span>Routes,</div>
<div class="sourceLine" id="cb4-6" data-line-number="6">        <span class="st">&quot;JourneyPatternTimingLinks&quot;</span><span class="op">:</span><span class="st"> </span>JourneyPatternTimingLinks,</div>
<div class="sourceLine" id="cb4-7" data-line-number="7">        <span class="st">&quot;Services&quot;</span><span class="op">:</span><span class="st"> </span>Services,</div>
<div class="sourceLine" id="cb4-8" data-line-number="8">        <span class="st">&quot;JourneyPatterns&quot;</span><span class="op">:</span><span class="st"> </span>JourneyPatterns,</div>
<div class="sourceLine" id="cb4-9" data-line-number="9">        <span class="st">&quot;VehicleJourneys&quot;</span><span class="op">:</span><span class="st"> </span>VehicleJourneys</div>
<div class="sourceLine" id="cb4-10" data-line-number="10">    }</div></code></pre>
<p>Defines the Operating Profile XPaths which require scraping via <code>get_varying_child_tags</code> rather than <code>get_df</code> as per all other XPaths.</p>
<pre class="sourceCode r" id="cb5"><code class="sourceCode r"><div class="sourceLine" id="cb5-1" data-line-number="1">    op_prof_paths =<span class="st"> </span>[</div>
<div class="sourceLine" id="cb5-2" data-line-number="2">                <span class="st">&quot;./txc:VehicleJourneys/txc:VehicleJourney/txc:OperatingProfile/*&quot;</span>,</div>
<div class="sourceLine" id="cb5-3" data-line-number="3">                <span class="st">&quot;./txc:Services/txc:Service/txc:OperatingProfile/*&quot;</span></div>
<div class="sourceLine" id="cb5-4" data-line-number="4">            ]</div></code></pre>
</div>
</div>

<p>Copyright &copy; Ruaridh Williamson 2017</p>
<p>Powered by TfL Open Data //
Contains OS data &copy; Crown copyright and database rights 2016</p>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
